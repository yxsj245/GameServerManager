name: åŒæ­¥mainåˆ†æ”¯åˆ°featureåˆ†æ”¯

on:
  push:
    branches:
      - main

jobs:
  sync-to-feature:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–å®Œæ•´çš„gitå†å²
          token: ${{ secrets.ACTIONS_PAT }}
      
      - name: é…ç½®Gitç”¨æˆ·ä¿¡æ¯
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
      
      - name: å¼ºåˆ¶æ¨é€åˆ°featureåˆ†æ”¯
        run: |
          # æ£€æŸ¥featureåˆ†æ”¯æ˜¯å¦å­˜åœ¨
          if git ls-remote --heads origin feature | grep -q feature; then
            echo "featureåˆ†æ”¯å­˜åœ¨ï¼Œå‡†å¤‡å¼ºåˆ¶æ¨é€"
            git push origin main:feature --force
          else
            echo "featureåˆ†æ”¯ä¸å­˜åœ¨ï¼Œåˆ›å»ºå¹¶æ¨é€"
            git checkout -b feature
            git push origin feature --set-upstream
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.ACTIONS_PAT }}
      
      - name: è¾“å‡ºåŒæ­¥ç»“æœ
        run: |
          echo "âœ… æˆåŠŸå°†mainåˆ†æ”¯çš„æœ€æ–°ä»£ç å¼ºåˆ¶æ¨é€åˆ°featureåˆ†æ”¯"
          echo "ğŸ“ æ¨é€çš„æäº¤: ${{ github.sha }}"
          echo "ğŸ‘¤ æ¨é€è€…: ${{ github.actor }}"
